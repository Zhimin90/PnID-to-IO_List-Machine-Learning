# PnID-to-IO_List-Machine-Learning

### Require pre-install pandastable, sklearn

pip install pandastable sklearn

What Does an Instrumentation Engineer do?
An instrumentation engineer could be responsible for any part of the lifecycle of a control process. They can be tasked with planning, design, development, and installation of a new process. They could also monitor, maintain and manage teams responsible for control systems already in place.
While the specific tasks of any given instrumentation engineering job will depend upon the control systems involved and the end product being created, tasks might include:
• Working with stakeholders to design and develop new control processes
• May involve procurement and budgetary responsibility
• Installation of new control processes
• Development of instrumentation testing protocols
• Daily monitoring of sensor outputs and process operation
• Ensuring instrumentation operation complies with quality parameters
• Carrying out routine/planned maintenance
• Troubleshooting any issues or concerns
• Optimisation of processes to improve system efficiency
• Data collection and analysis
• Report writing
• Supervision of instrumentation technicians and other junior team members
• Training production staff if required
https://www.getreskilled.com/what-is-an-instrumentation-engineer/

#### What part of the engineering process is the most time consuming?

When engineering a lubricant blending skid, instrumentation engineering is a time-consuming process. Modern lubricant blending plants have up to tens of thousands of IO points. Assigning these IOs into structured order is a massive undertaking. An Instrumentation engineer can expend hundreds of hours to process information from P&ID, piping and instrumentation diagram, generated by process engineer. An instrumentation engineer processes the information from P&ID and plot plan drawing and translate it into wiring into a level of at which electrician can understand. As part of this process, an instrumentation engineer will need to group individual IO points into clusters and assign a communication pick up point for the control system to read and write into. This process is currently executed manually in Excel and can take multiple weeks depending on the size of the plant.

#### How can this part be automated?

#### Proposed application function

#### What machine learning solutions will be implemented in this application.

##### DWG Number Tag Area Type Description Manufacturer Class Name PnPID Area No Unit No Supplied By Status Sequence Number Suffix Signal Type 1 Signal Type 2 Signal Type 3

The purpose  of this application is to automate the grouping of instrument tags into IFM ASi gateways. This application uses a variety of machine learning algorithms to determine the best gateway assignment for each instrument tag based on attributes generated by P&ID export csv file.

In order to assign each instrument tag into their respective gateway, relative location information will be needed on per instrument tag basis. Assigning each instrument tag is a time consuming and manual process. Machine learning algorithm can be developed to automate this process.

There is no location reference information tied to the P&ID information. As part of the normal instrumentation engineering, the instrumentation engineer refers to plot plan drawing provided by the mechanical engineer. This process is automated as by semi-supervised learning process. User of the application can sample a variety of instrument tags and mark their respective equipment location. Not all instrument tag locations need to be marked. The user can command the application to learn the rest of the location and gateway assignment and give the application’s best guess for gateway assignment. The user will continue to tag locations and the application will continue to  learn until the gateway assignments are all logical and sound to the user. 

A GUI or user interface has been built with Tkinter library that allows the user to drop a plot plan in picture format. The application randomly samples several equipment instances with their respective instrument and equipment tags. The application will allow the user to mark coordinate on top of the plot plan. This information is then saved in the Pandas dataframe to their respective instrument tag in the application. This allow the user to input the relative instrument location information which can be used in the semi-supervised machine learning algorithm.
The user of the application tags the location of randomly chosen instrument tags. These randomly chosen instrument tags should cover a breadth of equipment types and instrument types. Once a theoretical number of minimum tags has been located, a clustering algorithm will be used to bin the tagged instrument into equipment unit labels. Various instruments of close proximity in relative tagged locations will be binned into the same equipment. A DBSCAN algorithm would be appropriate for this application. Each equipment unit label will be assigned a centroid like location with the mean of the instrument tag locations as its labeled location. The tagged instruments are grouped as equipment unit labels and these labels serve as the training target for the rest of the unlabeled instrument locations. Each of the unmarked location instrument tags will be classified by based on the attributes shown previously into their respective equipment unit label and assigned centroid location. Various classification algorithms such as KNN, decision tree, SVM, and ADA boost will be tested on a previously labeled tag and unit information that serves as the truth. The theoretical number of minimum tags is found to be approximately 10 percent of the number of instrument tag. This test of the classification accuracy is determined by creating a list of subsets of the training set that various in number of instrument tags from 36 as 100% down to 20%. 36 instrument tags are chosen to be the maximum number of previously tagged location because with KNN classification, the accuracy is 100%. Detail on this evaluation and detail comments on implementation of the machine learning model can be found in the ProjectDirectory\Modeling\DSC478 - Final Project.ipynb or  https://github.com/Zhimin90/PnID-to-IO_List-Machine-Learning/blob/master/Modeling/DSC478%20-%20Final%20Project.ipynb

Once all instrument tags, labeled and unlabeled, has been assigned to a location, a modified version of DBSCAN algorithm will group these tags into their respective gateway based on location information.  https://github.com/Zhimin90/dbscan With IFM ASi network protocol, each gateway can accommodate update 60 addresses. This equates to approximately 100 instrument tags per gateway. A clustering algorithm based on DBSCAN is used to group these instruments into clusters with a capacity of 100 instrument tags. This modified algorithm uses DBSCAN’s breadth neighbor first search to append nearest neighbors into a queue. Instrument tags are be assigned into clusters until either the maximum limit of 100 instrument tags has been reached or alternatively there are no more instrument tags within the density radius and the current cluster contains 80 tags or more. By forcing an 80 percent or more threshold, this algorithm ensures each gateway is filled with at least 80 or more instrument tags. Consequently, there are no sparsely assigned gateways even in remote locations where there are little sparsely located instrument tags.


#### Application Structure and Operation

The application is written in Python 3. The user interface is based on Tkinter and pandastable. User will be able to import the P&ID output as a csv file into pandastable and view it as a dataframe. User can drop a pin in a plot plan drawing when CTRL+LeftMouseClick the instrument tag RLocation cell. This will allow the user to enter a relative location reference the particular instrument tag which a click of a button. Once the user tagged a desired amount, greater than 30, of instrument locations, the user can CTRL+L to trigger the learning script, LearnActionScript.py, to process the temp_model.pickle file which is the current dataframe being displayed. The learning script is another python script that process the pickle file and writes into learnedmodel.pickle with the assigned gateway label. This pickle file is automatically read into the display when the learning script finishes executing. When the user is ready to generate the IO_List, CTRL+O triggers the program to output a IO_List.csv file into the root directory of the program folder.

To run the program, execute Run.bat in the same directory as LocationTaggerApp.py

https://youtu.be/2yl-cxlaDyY Video Demonstration
